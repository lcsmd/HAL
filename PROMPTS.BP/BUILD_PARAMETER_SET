! Program: BUILD_PARAMETER_SET
! Description: Allows user to create or edit parameter sets.
    ! Author: Lawrence C Sullivan MD
    ! Date:11-18-2024 

PROGRAM BUILD_PARAMETER_SET

    * Get command-line arguments
    PARAM_SET_NAME = TRIM(FIELD(@SENTENCE, " ", 2))

    IF PARAM_SET_NAME = '' THEN
        CRT 'Enter parameter set name: '
        INPUT PARAM_SET_NAME
        PARAM_SET_NAME = TRIM(PARAM_SET_NAME)
    END

    * Add .PPS extension if not included
    IF INDEX(UPCASE(PARAM_SET_NAME), '.PPS', 1) = 0 THEN
        PARAM_SET_NAME := '.PPS'
    END

    OPEN 'PROMPTS_PARAMETER_SET' TO PARAM_SET.FILE ELSE
        CRT 'Cannot open PROMPTS_PARAMETER_SET directory file.'
        STOP
    END

    * Delete existing parameter set
    DELETE PARAM_SET.FILE, PARAM_SET_NAME

    PARAM_SET_DATA = ''

    OPEN 'PROMPTS_PARAMETERS' TO PARAMS.FILE ELSE
        CRT 'Cannot open PROMPTS_PARAMETERS file.'
        STOP
    END

    CRT 'Enter values for the following parameters:'
    SELECT PARAMS.FILE
    LOOP
        READNEXT PARAM_KEY ELSE EXIT
        READ PARAM_VALUE FROM PARAMS.FILE, PARAM_KEY ELSE PARAM_VALUE = ''
        IF PARAM_VALUE = '*' THEN
            PARAM_NAME = CONVERT('_', ' ', PARAM_KEY)
            CRT PARAM_NAME : ': '
            INPUT USER_VALUE
            USER_VALUE = TRIM(USER_VALUE)
            PARAM_SET_DATA<1, DCOUNT(PARAM_SET_DATA<1>, @VM) + 1> = PARAM_KEY
            PARAM_SET_DATA<2, DCOUNT(PARAM_SET_DATA<2>, @VM) + 1> = USER_VALUE
        END
    REPEAT

    WRITE PARAM_SET_DATA ON PARAM_SET.FILE, PARAM_SET_NAME
    CRT 'Parameter set saved as ' : PARAM_SET_NAME

END

