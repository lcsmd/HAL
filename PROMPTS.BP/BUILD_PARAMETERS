! Program: BUILD_PARAMETERS
! Description: Allows user to create or edit parameters and their possible values.
! Author: Lawrence C Sullivan MD
! Date:11-18-2024 

PROGRAM BUILD_PARAMETERS

    * Get command-line arguments
    PARAM_NAME = FIELD(@UPCASE.ARGS, ' ', 2)
    PARAM_NAME = TRIM(PARAM_NAME)

    OPEN 'PROMPTS_PARAMETERS' TO PARAMS.FILE ELSE
        CRT 'Cannot open PROMPTS_PARAMETERS file.'
        STOP
    END

    IF PARAM_NAME = '' THEN
        GOSUB LIST_PARAMETERS
    END ELSE
        GOSUB EDIT_PARAMETER
    END

    STOP

LIST_PARAMETERS:
    CRT 'Existing Parameters:'
    SELECT PARAMS.FILE
    LOOP
        READNEXT PARAM_KEY ELSE EXIT
        CRT PARAM_KEY
    REPEAT

    CRT 'Enter parameter name to edit or create (or press ENTER to cancel): '
    INPUT PARAM_NAME
    PARAM_NAME = TRIM(PARAM_NAME)
    IF PARAM_NAME = '' THEN
        RETURN
    END
    GOSUB EDIT_PARAMETER
RETURN

EDIT_PARAMETER:
    PARAM_KEY = CONVERT(' ', '_', PARAM_NAME)

    PARAM_VALUE = ''
    READ PARAM_VALUE FROM PARAMS.FILE, PARAM_KEY THEN
        CRT 'Parameter found. Current values:'
        FOR I = 1 TO DCOUNT(PARAM_VALUE, @VM)
            CRT I : '. ' : PARAM_VALUE<I>
        NEXT I
    END ELSE
        CRT 'Parameter not found. Creating new parameter.'
    END

    * Delete existing parameter before editing
    DELETE PARAMS.FILE, PARAM_KEY

    LOOP
        CRT 'Enter a new value (or type DONE to finish): '
        INPUT NEW_VALUE
        NEW_VALUE = TRIM(NEW_VALUE)
        IF UPCASE(NEW_VALUE) = 'DONE' THEN EXIT
        PARAM_VALUE<-1> = NEW_VALUE
    REPEAT

    WRITE PARAM_VALUE ON PARAMS.FILE, PARAM_KEY
    CRT 'Parameter saved.'
RETURN

END
