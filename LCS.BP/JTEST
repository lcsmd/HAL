      PROGRAM JS.TEST2
      *$INCLUDE Q.INCLUDES QB.COMMON.H
      $INCLUDE INCLUDES KEYS.H
      CLR.SCR=@(-1)
      CRT CLR.SCR:'JSON Testing'
      CRT

      OPEN "YT-JSON" TO F.LCS ELSE PRINT 'LCS';STOP
      READ JSON.data FROM F.LCS,"6aNTj2oG8K8.json" ELSE json.data=''
      JSON.DOCUMENT = JPARSE(JSON.data)
      IF STATUS() THEN
         PRINT "Error parsing JSON at position ": INMAT()
         STOP
      END
      CRT "author: ": JSON.DOCUMENT{'author'}
      CRT "published_at: ": JSON.DOCUMENT{'published_at'}
      CRT "title: ": JSON.DOCUMENT{'title'}
      crt "description: ": json.document{'description'}
      SCAN json.dOCUMENT RESET
      LOOP
         SCAN json.dOCUMENT SETTING NAME, VALUE ELSE EXIT
         DISPLAY 'Element ' : NAME : ' has value ' : VALUE
      REPEAT


      VIDEOS = COLLECTION()
      xpos = 41
      oktypes = '1,2,3,5'
      js = JPARSE(json.data)
      *JB=JBUILD(JS)
      *PRINT JS
      PRINT STR("-",40)
      *PRINT JB
      *PRINT JSON
      names = ENUMERATE(js)
      dcn = DCOUNT(names, @AM)
      PRINT NAMES
      PRINT DCN
      FOR nno = 1 TO dcn
         path = names<nno>
         node = js{path}
         GOSUB node.parse(path, node)
      NEXT nno

      STOP


      LOCAL SUBROUTINE node.parse((path), (node))
      PRIVATE vt

      vt = VARTYPE(node)
      BEGIN CASE
         CASE (LISTINDEX(oktypes, ',', vt))
            CRT path:@(xpos):node
         CASE (vt EQ VT$NULLVALUE)
            CRT path:@(xpos):'null'
         CASE (vt EQ VT$COLLECTION)
            GOSUB node.parse.collection(path, node)
         CASE (vt EQ VT$ARRAY)
            GOSUB node.parse.array(path, node)
         CASE (1)
            CRT path:@(xpos):'Type: ':vt
      END CASE

      RETURN
      END

      LOCAL SUBROUTINE node.parse.array((path), (node))
      PRIVATE apath, elcnt, elem, elno, eltype

      elcnt = INMAT(node)
      FOR elno = 1 TO elcnt
         elem = node{elno}
         apath = path:'[':elno:']'
         eltype = VARTYPE(elem)
         BEGIN CASE
            CASE (LISTINDEX(oktypes, ',', eltype))
               CRT apath:@(xpos):elem
            CASE (eltype EQ VT$NULLVALUE)
               CRT apath:@(xpos):'null'
            CASE (eltype EQ VT$COLLECTION)
               GOSUB node.parse.collection(apath, elem)
            CASE (eltype EQ VT$ARRAY)
               GOSUB node.parse.array(apath, elem)
            CASE (1)
               CRT path:@(xpos):'Type: ':eltype
         END CASE
      NEXT elno

      RETURN
      END

      LOCAL SUBROUTINE node.parse.collection((path), (node))
      PRIVATE cnames, cname, cno, cnode, cpath, ctype, dcc

      cnames = ENUMERATE(node)
      dcc = DCOUNT(cnames, @AM)
      FOR cno = 1 TO dcc
         cname = cnames<cno>
         cpath = path:'/':cname
         cnode = node{cname}
         ctype = VARTYPE(cnode)
         BEGIN CASE
            CASE (LISTINDEX(oktypes, ',', ctype))
               CRT cpath:@(xpos):cnode
            CASE (ctype EQ VT$NULLVALUE)
               CRT cpath:@(xpos):'null'
            CASE (ctype EQ VT$COLLECTION)
               GOSUB node.parse.collection(cpath, cnode)
            CASE (ctype EQ VT$ARRAY)
               GOSUB node.parse.array(cpath, cnode)
            CASE (1)
               CRT path:@(xpos):'Type: ':ctype
         END CASE
      NEXT cno

      RETURN
      END

      END
