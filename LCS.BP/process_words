      PROGRAM PROCESS_WORDS

      open 'WORDS' TO F.WORDS ELSE PRINT 'WORDS';STOP
      start.TIME=TIMEDATE()
      PARAMS = @SENTENCE
      INPFILE = FIELD(PARAMS, " ", 2)
      DOCFILE = FIELD(PARAMS, " ", 3)

      IF INPFILE = "" OR DOCFILE = "" THEN
         PRINT "Usage: PROCESS_WORDS <directory> <document.file.name>"
         STOP
      END

      OPEN INPFILE TO F.INPFILE ELSE PRINT INPFILE;STOP

      READ TEXT FROM F.INPFILE,DOCFILE ELSE
         PRINT "Document doesn't exist: ":DOCFILE:" in file ":INPFILE
         STOP
      END
      CLOSE F.INPFILE

      NEW.WORDS = ""
      NEW.COUNTS=""

      GOSUB ProcessText:
      gosub summarize.results:

      PRINT "Processing complete."
      STOP

ProcessText:
      open "WORDS.LCS" to F.WORDS ELSE
         CREATE.FILE "WORDS.LCS" DYNAMIC ON ERROR PRINT "ERROR CREATEING WORDS.LCS";STOP
         OPEN "WORDS.LCS" TO F.WORDS ELSE PRINT "WORDS.LCS";STOP
      END
      new.unique.words.ct = 0
      nums_and_punc = '0123456789!"#$%&()*+,./:;<=>?@[\\]^_`{|}~'
      print "starting text length:":len(text)
      *; Remove each number and punctuation mark
      print "removing punctuation and numbers":TIMEDATE()
      FOR i = 1 TO LEN(nums_and_punc)
         TEXT = DOWNCASE(TRIM(TEXT))
         char = nums_and_punc[i, 1]
         text = TRIM(text, char, "A")
      NEXT i
      TEXT=CHANGE(TEXT," ",@FM)
      word.ct = DCOUNT(TEXT,@FM)
      for WORD.x = 1 to WORD.CT
         WORD=TEXT<WORD.X>
         if len(word) > 1 then
            read word.b from f.words,word else
               word.b = ""
               new.unique.words.ct += 1
            end
            word.b<1> += 1
            write word.b on f.words,word
         end
         if not(mod(WORD.X,100)) then print space(25):WORD.x:"  ":TIMEDATE()
      next WORD.x
      return

UpdateWordsFile:
      open "WORDS.LCS" to F.WORDS ELSE
         CREATE.FILE "WORDS.LCS" DYNAMIC ON ERROR PRINT "ERROR CREATEING WORDS.LCS";STOP
         OPEN "WORDS.LCS" TO F.WORDS ELSE PRINT "WORDS.LCS";STOP
      END
      PRINT NEW.WORDS
      words.count=dcount(new.words,@FM)
      print new.counts
      FOR WORD.X = 1 TO words.count
         word = new.words<word.x>
         words.count=new.counts<word.x>
         print "updating word in WORDS.LCS file:":word:
         print "writing ":word:" ":words.count
         read word.b from f.words,word then
            print " ":word.b<1>:" + ":new.counts<word.x>:" --> ":
            word.b<1> += new.counts<word.x>
            new.unique.words.ct += 1
         end else
            word.b =""
            word.b<1> = new.counts<word.x>
         end
         READv exist from f.words,word,0 then
            print word.b<word.x>
            write word.b on f.words,word
         end
      next word.x


      print words.stats.b
      DICT.BEGIN.CT = words.stats.b<1>
      words.stats.b<1> += WORD.CT
      words.stats.b<2> += new.unique.words.ct
      write words.stats.b on f.lcs,"WORDS.STATS"
      CLOSE F.LCS
      CLOSE F.WORDS
      return


summarize.results:
      execute "count WORDS.LCS" CAPTURING CAP

      open "LCS.CONTROL" TO F.LCS ELSE PRINT "LCS.CONTROL";STOP
      read words.stats.b from f.lcs,"WORDS.STATS" ELSE
         WORDS.STATS.B = ""
         words.stats.b<1> = 0
         words.stats.b<2> = 0
         write words.stats.b on f.lcs,"WORDS.STATS"
         print "The dictionary began with ":dict.begin.ct:" words"
         print word.ct:" words were processed"
         print new.unique.words.ct:" unique words were added to the dictionary"
         print "There are now ":words.stats.b<1>:" words in the dictionary."
         print "after processing ":words.stats.b<2>:" have been processed"
         print "TIME to process:"
      END
      return
      end

