      SUBROUTINE ProcessMetaFile(directory, textFileName, MET_REC)
      *$INCLUDE QMDEFS

      COMMA = "," ; *
      TAB = CHAR(9) ; *
      SPACE = " " ; *
      DLM = TAB ; *

      * Initialize variables
      OpenPath = directory : "/" : textFileName
      fieldCount = 0

      * Open the text file for reading
      OPENSEQ OpenPath TO fileHandle ELSE
         CRT "Cannot open file ":OpenPath
         RETURN
      END

      * Read and process the meta file
      LOOP
         READSEQ line FROM fileHandle ELSE EXIT
         line = TRIM(line)

         * Skip empty lines
         IF line = "" THEN CONTINUE

         * Check for key sections and handle accordingly
         IF line[1, 8] = "[FILEDEF" THEN GOSUB ProcessFileDef
         ELSE IF line[1, 9] = "[FIELDDEF" THEN GOSUB ProcessFieldDef
         ELSE IF line[1, 9] = "[COMMENTS" THEN GOSUB ProcessComments
         ELSE IF line[1, 14] = "[ASSOCIATIONS" THEN GOSUB ProcessAssociations
         ELSE IF line[1, 7] = "[VIEWS" THEN GOSUB ProcessViews
         ELSE IF line[1, 6] = "[CATS" THEN GOSUB ProcessCategories
      REPEAT

      CLOSESEQ fileHandle
      CRT "Meta file processing completed successfully."
      RETURN

ProcessFileDef:
      LOOP
         READSEQ line FROM fileHandle ELSE RETURN
         line = TRIM(line)
         IF line = "" THEN EXIT
         IF line[1, 9] = "[FIELDDEF" THEN RETURN
         * Process FILEDEF line to extract file definitions
         fileName = TRIM(FIELD(line, DLM, 2))
         fileType = TRIM(FIELD(line, DLM, 8))
         IF fileType = "" THEN fileType = "DYNAMIC"
         * Create the database file
         cmd = "CREATE.FILE " : fileName : " " : fileType
         EXECUTE cmd CAPTURING cap
         CRT cap
      REPEAT
      RETURN

ProcessFieldDef:
      fieldCount = 0
      LOOP
         READSEQ line FROM fileHandle ELSE RETURN
         line = TRIM(line)
         IF line = "" THEN EXIT
         IF line[1, 9] = "[COMMENTS" OR line[1, 14] = "[ASSOCIATIONS" OR line[1, 7] = "[VIEWS" OR line[1, 6] = "[CATS" THEN RETURN
         * Process FIELDDEF line to extract field definitions
         fieldCount += 1
         fieldName = TRIM(FIELD(line, DLM, 1))
         fieldType = "D" ; * Default type
         attrNumber = fieldCount
         * Create dictionary entry
         dictRecord = fieldType:"*":fieldName:@FM:attrNumber
         WRITE dictRecord ON "DICT ":fileName, fieldName
      REPEAT
      RETURN

ProcessComments:
      LOOP
         READSEQ line FROM fileHandle ELSE RETURN
         line = TRIM(line)
         IF line = "" THEN EXIT
         IF line[1, 14] = "[ASSOCIATIONS" THEN RETURN
         * Process COMMENT line to extract comment details
      REPEAT
      RETURN

ProcessAssociations:
      LOOP
         READSEQ line FROM fileHandle ELSE RETURN
         line = TRIM(line)
         IF line = "" THEN EXIT
         IF line[1, 7] = "[VIEWS" THEN RETURN
         * Process ASSOCIATION line to extract association definitions
      REPEAT
      RETURN

ProcessViews:
      LOOP
         READSEQ line FROM fileHandle ELSE RETURN
         line = TRIM(line)
         IF line = "" THEN EXIT
         IF line[1, 6] = "[CATS" THEN RETURN
         * Process VIEW line to extract view definitions
      REPEAT
      RETURN

ProcessCategories:
      LOOP
         READSEQ line FROM fileHandle ELSE RETURN
         line = TRIM(line)
         IF line = "" THEN EXIT
         * Process CATEGORY line to extract category definitions
      REPEAT
      RETURN

      END
