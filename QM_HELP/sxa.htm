<!DOCTYPE html>
<html>
<head>
   <title>Building a Self-Installing Application</title>
   <meta name="generator" content="Help &amp; Manual" />
   <meta name="keywords" content="Self-installing applications" />
   <meta http-equiv="Content-Type" content="text/html; charset=UTF-8" />
   <meta http-equiv="Content-Style-Type" content="text/css" />
   <link type="text/css" href="default.css" rel="stylesheet" />
   <script type="text/javascript" src="jquery.js"></script>
   <script type="text/javascript" src="helpman_settings.js"></script>
   <script type="text/javascript" src="helpman_topicinit.js"></script>

   <script type="text/javascript">
     HMSyncTOC("index.html", "sxa.htm");
   </script>
   <script type="text/javascript" src="highlight.js"></script>
   <script type="text/javascript">
     $(document).ready(function(){highlight();});
   </script>
</head>
<body style="margin: 0px 0px 0px 0px; background: #FFFFFF;">


<table width="100%" border="0" cellspacing="0" cellpadding="5" bgcolor="#649CCC">
  <tr valign="middle">
    <td align="left">
      <h1 class="p_Heading1"><span class="f_Heading1">Building a Self-Installing Application</span></h1>

    </td>
    <td align="right">
     <span style="font-size: 9pt">
     <a href="titlepage.htm"><img src="top.gif" border=0 alt="Top"></a>&nbsp;
     <a href="package_licensing.htm"><img src="previous.gif" border=0 alt="Previous"></a>&nbsp;
     <a href="cgi.htm"><img src="next.gif" border=0 alt="Next"></a>
     </span>
    </td>
  </tr>
</table>


<!-- Placeholder for topic body. -->
<table width="100%" border="0" cellspacing="0" cellpadding="5"><tr valign="top"><td align="left">
<p class="p_Normal">&nbsp;</p>
<p class="p_Normal">If you are developing an application to be provided as a complete user-installable package, you probably want to automate as much as possible of this. Ideally, you would like the user to need only to execute a single program to install both QM and the application software. This section describes two ways to do this.</p>
<p class="p_Normal">&nbsp;</p>
<p class="p_Normal">&nbsp;</p>
<p class="p_BoldSubheading"><span class="f_BoldSubheading">Using a Commercial Installer Package</span></p>
<p class="p_Normal">&nbsp;</p>
<p class="p_Normal">The Windows version of QM uses the Astrum InstallWizard from Thraex Software but this is no longer maintained. It can still be downloaded from several locations on the web. The following process should map onto other self-installer packages.</p>
<p class="p_Normal">&nbsp;</p>
<p class="p_Normal">Whatever installer package you use, it needs to install both QM and the application. The complication is that this process needs to run QM to create the account that will hold the application. The steps to achieve this are:</p>
<p class="p_Normal">&nbsp;</p>
<p style="text-indent: 0; padding-left: 30px; margin: 0 0 0 30px;"><span class="f_Normal" style="display:inline-block;width:30px;margin-left:-30px">1.</span>Unpack all the application files to wherever they need to go. The directory that will become the application account can be created during this process but the only QM specific subdirectory that should be created is the private catalogue (cat). You can place your own application install program into the cat subdirectory for later use. If you need to pre-load dictionary items or data file records, these should be unpacked into a temporary location.</p><p class="p_Normal">&nbsp;</p>
<p style="text-indent: 0; padding-left: 30px; margin: 0 0 0 30px;"><span class="f_Normal" style="display:inline-block;width:30px;margin-left:-30px">2.</span>The self-extracting file must also include the relevant version of QM as its own self-extracting file. This should be unpacked into a temporary directory.</p><p class="p_Normal">&nbsp;</p>
<p style="text-indent: 0; padding-left: 30px; margin: 0 0 0 30px;"><span class="f_Normal" style="display:inline-block;width:30px;margin-left:-30px">3.</span>Once everything has been unpacked, the process now needs to install QM by executing the QM self-extracting program. On Windows systems, use of the /silent command line option will suppress most user interaction.</p><p class="p_Normal">&nbsp;</p>
<p style="text-indent: 0; padding-left: 30px; margin: 0 0 0 30px;"><span class="f_Normal" style="display:inline-block;width:30px;margin-left:-30px">4.</span>Now that QM is installed (or upgraded), you need to use it to create the application account. The process should check whether the account already exists by looking for the VOC file and, if not, execute QM with a single command line option of</p><p style="margin: 0 0 0 90px;"> &quot;CREATE.ACCOUNT <span style="font-style: italic;">account.name</span> <span style="font-style: italic;">account.path</span> NO.QUERY&quot;.</p>
<p style="margin: 0 0 0 60px;">The quotes are required in this command and the working directory should be the QMSYS account. The <span style="font-weight: bold;"><a href="create_account.htm" class="topiclink">CREATE.ACCOUNT</a></span> command will not fail if the cat subdirectory already exists.</p>
<p class="p_Normal">&nbsp;</p>
<p style="text-indent: 0; padding-left: 30px; margin: 0 0 0 30px;"><span class="f_Normal" style="display:inline-block;width:30px;margin-left:-30px">5.</span>Next, you need to execute your own application installer program that should have been included in the contents of the unpacked private catalogue directory. This is done by executing QM with a command line option that is the catalogued item name and with a working directory of the newly created account.</p><p class="p_Normal">&nbsp;</p>
<p style="text-indent: 0; padding-left: 30px; margin: 0 0 0 30px;"><span class="f_Normal" style="display:inline-block;width:30px;margin-left:-30px">6.</span>Finally, you need to remove any temporary files.</p><p class="p_Normal">&nbsp;</p>
<p class="p_Normal">So, what does the catalogued install program need to do?</p>
<p style="text-indent: 0; padding-left: 30px; margin: 10px 0 0 30px;"><span class="f_Normal" style="font-family: Arial,'Lucida Sans Unicode','Lucida Grande','Lucida Sans';display:inline-block;width:30px;margin-left:-30px">&#8226;</span>We recommend that it should start by executing a <span style="font-weight: bold;"><a href="como.htm" class="topiclink">COMO</a></span> command to create a log file of its progress.</p><p style="text-indent: 0; padding-left: 30px; margin: 10px 0 0 30px;"><span class="f_Normal" style="font-family: Arial,'Lucida Sans Unicode','Lucida Grande','Lucida Sans';display:inline-block;width:30px;margin-left:-30px">&#8226;</span>Create any application files that do not already exist.</p><p style="text-indent: 0; padding-left: 30px; margin: 10px 0 0 30px;"><span class="f_Normal" style="font-family: Arial,'Lucida Sans Unicode','Lucida Grande','Lucida Sans';display:inline-block;width:30px;margin-left:-30px">&#8226;</span>Copy dictionary items from a temporary set of dictionaries unpacked from the install file. By doing this rather than simply overwriting the dictionaries, anything that had been added will not be lost when updating an existing installation.</p><p style="text-indent: 0; padding-left: 30px; margin: 10px 0 0 30px;"><span class="f_Normal" style="font-family: Arial,'Lucida Sans Unicode','Lucida Grande','Lucida Sans';display:inline-block;width:30px;margin-left:-30px">&#8226;</span>Build any indices that are required.</p><p style="text-indent: 0; padding-left: 30px; margin: 10px 0 0 30px;"><span class="f_Normal" style="font-family: Arial,'Lucida Sans Unicode','Lucida Grande','Lucida Sans';display:inline-block;width:30px;margin-left:-30px">&#8226;</span>Create any application specific VOC entries such as paragraphs and sentences.</p><p><span style="font-size: 10pt; font-family: Arial,Helvetica,sans-serif; color: #000000;">&nbsp;</span></p>
<p><span style="font-size: 10pt; font-family: Arial,Helvetica,sans-serif; color: #000000;">&nbsp;</span></p>
<p class="p_BoldSubheading"><span class="f_BoldSubheading">Using an Installation Script</span></p>
<p class="p_Normal">&nbsp;</p>
<p class="p_Normal">The QM installer includes a mechanism that can be used to link it to installation of your own software. To use this, you distribute your software on a CD or as a downloadable zip file. This should contain all of your application software and the QM installation package together with a text file named qmcfg.dat and the qmsetup program described below. This program can be found in the bin subdirectory of the QMSYS account of your QM development installation and may be freely distributed.</p>
<p class="p_Normal">&nbsp;</p>
<p class="p_Normal">To run the installation, the user executes the qmsetup program. This reads the qmcfg.dat file that contains data to control the installation process. There are two sections to this file which may appear in either order. Blank lines and lines commencing with a # character are ignored.</p>
<p class="p_Normal">&nbsp;</p>
<p class="p_Normal">The [qm] section contains QM configuration parameters that will be updated in the qmconfig file by the installer. All QM configuration parameters except for the licence details may be updated in this way. Registered QM resellers can request details of how to generate and apply QM licences automatically as part of the installation process.</p>
<p class="p_Normal">&nbsp;</p>
<p class="p_Normal" style="margin: 0 0 0 30px;">[qm]</p>
<p class="p_Normal" style="margin: 0 0 0 30px;">NUMFILES=200</p>
<p class="p_Normal" style="margin: 0 0 0 30px;">NUMLOCKS=400</p>
<p class="p_Normal" style="margin: 0 0 0 30px;">ERRLOG=10</p>
<p class="p_Normal" style="margin: 0 0 0 30px;">&nbsp;</p>
<p class="p_Normal">The [application] section contains instructions to the qmsetup program. These are executed in the order in which they appear.</p>
<p class="p_Normal">&nbsp;</p>
<p class="p_Normal" style="margin: 0 0 0 30px;">[application]</p>
<p class="p_Normal" style="margin: 0 0 0 30px;">EULA=licence.txt</p>
<p class="p_Normal" style="margin: 0 0 0 30px;">RUN=qm_4-0-7.exe /silent</p>
<p class="p_Normal" style="margin: 0 0 0 30px;">COPY=appdir;c:\program files\myapp</p>
<p class="p_Normal" style="margin: 0 0 0 30px;">CD=c:\program files\myapp</p>
<p class="p_Normal" style="margin: 0 0 0 30px;">RUN=qm setup</p>
<p class="p_Normal">&nbsp;</p>
<p class="p_Normal">The EULA command identifies a simple text file that will be displayed to the user as the end user licence agreement. This must be approved by the user before the installer moves on.</p>
<p class="p_Normal">&nbsp;</p>
<p class="p_Normal">The RUN command uses the operating system shell to execute the given command. In the example above, the first RUN command is used to execute the QM installer.</p>
<p class="p_Normal">&nbsp;</p>
<p class="p_Normal">The COPY command copies a file or directory. The source and destination pathnames should be separated by a semicolon. Any spaces in the names are taken as being part of the name.</p>
<p class="p_Normal">&nbsp;</p>
<p class="p_Normal">The CD command changes the current working directory. If no pathname is given, the directory holding the install script is assumed.</p>
<p class="p_Normal">&nbsp;</p>
<p class="p_Normal">Any command may contain &lt;mypath&gt; which will be replaced with the pathname of the directory from which the installation was run. Thus</p>
<p class="p_Normal"> &nbsp; CD=</p>
<p class="p_Normal">is equivalent to</p>
<p class="p_Normal"> &nbsp; CD=&lt;mypath&gt;</p>

</td></tr></table>

</body>
</html>
