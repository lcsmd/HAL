<!DOCTYPE html>
<html>
<head>
   <title>UPDATE.RECORD batch mode</title>
   <meta name="generator" content="Help &amp; Manual" />
   <meta name="keywords" content="UPDATE.RECORD batch mode" />
   <meta http-equiv="Content-Type" content="text/html; charset=UTF-8" />
   <meta http-equiv="Content-Style-Type" content="text/css" />
   <link type="text/css" href="default.css" rel="stylesheet" />
   <script type="text/javascript" src="jquery.js"></script>
   <script type="text/javascript" src="helpman_settings.js"></script>
   <script type="text/javascript" src="helpman_topicinit.js"></script>

   <script type="text/javascript">
     HMSyncTOC("index.html", "ur_batch.htm");
   </script>
   <script type="text/javascript" src="highlight.js"></script>
   <script type="text/javascript">
     $(document).ready(function(){highlight();});
   </script>
</head>
<body style="margin: 0px 0px 0px 0px; background: #FFFFFF;">


<table width="100%" border="0" cellspacing="0" cellpadding="5" bgcolor="#649CCC">
  <tr valign="middle">
    <td align="left">
      <h1 class="p_Heading1"><span class="f_Heading1">UPDATE.RECORD &nbsp;- &nbsp;Batch Mode</span></h1>

    </td>
    <td align="right">
     <span style="font-size: 9pt">
     <a href="titlepage.htm"><img src="top.gif" border=0 alt="Top"></a>&nbsp;
     <a href="update_record.htm"><img src="previous.gif" border=0 alt="Previous"></a>&nbsp;
     <a href="ur_visual.htm"><img src="next.gif" border=0 alt="Next"></a>
     </span>
    </td>
  </tr>
</table>


<!-- Placeholder for topic body. -->
<table width="100%" border="0" cellspacing="0" cellpadding="5"><tr valign="top"><td align="left">
<p><span style="font-size: 10pt; font-family: Arial,Helvetica,sans-serif; color: #000000;">&nbsp;</span></p>
<p><span style="font-weight: bold;">UPDATE.RECORD</span> runs in batch mode of the command line includes one or more <span style="font-style: italic;">field/value</span> specifications.</p>
<p><span style="font-size: 10pt; font-family: Arial,Helvetica,sans-serif; color: #000000;">&nbsp;</span></p>
<p>If the <span style="font-weight: bold;">EXCLUSIVE</span> keyword is used, <span style="font-weight: bold;">UPDATE.RECORD</span> will obtain exclusive access to the file by acquiring the file lock. If another user holds a record lock or the file lock when the command is issued, <span style="font-weight: bold;">UPDATE.RECORD</span> will terminate with an error message unless the <span style="font-weight: bold;">WAIT</span> keyword has been used, in which case a message is displayed and it repeats the attempt to lock the file at five second intervals.</p>
<p><span style="font-size: 10pt; font-family: Arial,Helvetica,sans-serif; color: #000000;">&nbsp;</span></p>
<p>For each record to be processed, <span style="font-weight: bold;">UPDATE.RECORD</span> first locks and reads the record. If another user has the record locked and the <span style="font-weight: bold;">WAIT</span> keyword has been used, <span style="font-weight: bold;">UPDATE.RECORD</span> will wait for the record to become available. If the <span style="font-weight: bold;">WAIT</span> keyword was not used, the record id is added to a list of locked records. If either the <span style="font-weight: bold;">INQUIRING</span> or <span style="font-weight: bold;">REPORTING</span> keywords was used, a message is output showing the id of the record that could not be locked.</p>
<p><span style="font-size: 10pt; font-family: Arial,Helvetica,sans-serif; color: #000000;">&nbsp;</span></p>
<p>If the specified record does not exist in the file and the <span style="font-weight: bold;">CREATING</span> keyword has been used, a new, empty record is created to which the amendments are then applied. If the <span style="font-weight: bold;">CREATING</span> keyword is not present, the record id is added to a list of missing records</p>
<p><span style="font-size: 10pt; font-family: Arial,Helvetica,sans-serif; color: #000000;">&nbsp;</span></p>
<p>Once the record has been successfully locked, <span style="font-weight: bold;">UPDATE.RECORD</span> performs each of the specified amendments in the order in which they appear on the command line. Each amendment may draw on the result of preceding amendments. Note in particular, that use of the <span style="font-weight: bold;">DELETING</span> option will result in new field positions for all later fields. The record id may be changed by specifying the target as field 0 or a dictionary item such as @ID that refers to field 0. Any I-type or EVAL expressions after the change of record id will see the new id in @ID.</p>
<p><span style="font-size: 10pt; font-family: Arial,Helvetica,sans-serif; color: #000000;">&nbsp;</span></p>
<p>The <span style="font-style: italic;">field</span> specification may be a numeric field position or the name of a D-type item from the dictionary or the VOC. The <span style="font-style: italic;">value</span> specification may be:</p>
<p><span style="font-size: 10pt; font-family: Arial,Helvetica,sans-serif; color: #000000;">&nbsp;</span></p>
<p style="margin: 0 0 0 30px;">A number or a quoted string.</p>
<p style="margin: 0 0 0 30px;"><span style="font-size: 10pt; font-family: Arial,Helvetica,sans-serif; color: #000000;">&nbsp;</span></p>
<p style="margin: 0 0 0 30px;">The name of an A, D, I or S-type dictionary or VOC item identifying the field from which data is to be copied. If this is an I-type item or an A/S-type item with a correlative expression, it must have been compiled prior to use by <span style="font-weight: bold;">UPDATE.RECORD</span>.</p>
<p style="margin: 0 0 0 30px;"><span style="font-size: 10pt; font-family: Arial,Helvetica,sans-serif; color: #000000;">&nbsp;</span></p>
<p style="margin: 0 0 0 30px;">The keyword <span style="font-weight: bold;">EVAL</span> followed by an I-type expression in single or double quotes. This expression will be compiled by <span style="font-weight: bold;">UPDATE.RECORD</span> and evaluated to determine the new value of the field. </p>
<p><span style="font-size: 10pt; font-family: Arial,Helvetica,sans-serif; color: #000000;">&nbsp;</span></p>
<p><span style="font-weight: bold;">UPDATE.RECORD</span> honours dictionary conversion specifications for both the source and target data items. Where the new <span style="font-style: italic;">value</span> for a field is derived via a dictionary name, the value is first converted to its external form. Where the field to be updated is identified via a dictionary name, the new value is converted to its internal form prior to storing in the record. If the <span style="font-style: italic;">value</span> specification is followed by the <span style="font-weight: bold;">CONV</span> keyword and a quoted conversion specification, this will overrule any conversion specified in the dictionary. <span style="font-weight: bold;">UPDATE.RECORD</span> will report a warning message if the conversion generates an error when applied to <span style="font-style: italic;">value</span>. </p>
<p>&nbsp;</p>
<p>The <span style="font-weight: bold;">REPORTING</span> keyword causes <span style="font-weight: bold;">UPDATE.RECORD</span> to produce a detailed report of each amendment made, including the record id together with the old and new values of each field amended. This report can be directed to a specific print unit using the <span style="font-weight: bold;">LPTR</span> keyword.</p>
<p><span style="font-size: 10pt; font-family: Arial,Helvetica,sans-serif; color: #000000;">&nbsp;</span></p>
<p>In the absence of the <span style="font-weight: bold;">REPORTING</span> and <span style="font-weight: bold;">INQUIRING</span> keywords or if the report is directed to a print unit rather than the display, <span style="font-weight: bold;">UPDATE.RECORD</span> displays a progress report in the form of a series of asterisks.</p>
<p><span style="font-size: 10pt; font-family: Arial,Helvetica,sans-serif; color: #000000;">&nbsp;</span></p>
<p>On completion of the update, <span style="font-weight: bold;">UPDATE.RECORD</span> may create two entries in the $SAVEDLISTS file. If one or more records could not be updated because they were locked by other users, a select list named &amp;LOCK.<span style="font-style: italic;">userno</span>&amp; is created containing a list of such records. If one or more records specified for update did not exist in the file and the <span style="font-weight: bold;">CREATING</span> keyword was not used, a select list named &amp;MISS.<span style="font-style: italic;">userno</span>&amp; is created containing a list of the missing record ids. <span style="font-weight: bold;">UPDATE.RECORD</span> deletes any old versions of these lists at the start of the update.</p>
<p><span style="font-size: 10pt; font-family: Arial,Helvetica,sans-serif; color: #000000;">&nbsp;</span></p>
<p>Note that the database locking system is of a voluntary nature. Both the file and record level locking performed by <span style="font-weight: bold;">UPDATE.RECORD</span> only prevent other users acquiring the locks. A program that does not use locks correctly may still be able to access the file during the update.</p>
<p><span style="font-size: 10pt; font-family: Arial,Helvetica,sans-serif; color: #000000;">&nbsp;</span></p>
<p>On completion of the update, <span style="font-weight: bold;"><a href="at_variables.htm#system.return.code" class="topiclink">@SYSTEM.RETURN.CODE</a></span> will be set to the number of records updated. If the command terminates due to a command line error, <span style="font-weight: bold;"><a href="at_variables.htm#system.return.code" class="topiclink">@SYSTEM.RETURN.CODE</a></span> will be negative.</p>
<p><span style="font-size: 10pt; font-family: Arial,Helvetica,sans-serif; color: #000000;">&nbsp;</span></p>
<p><span style="font-size: 10pt; font-family: Arial,Helvetica,sans-serif; color: #000000;">&nbsp;</span></p>
<p><span style="font-weight: bold;">Examples</span></p>
<p><span style="font-size: 10pt; font-family: Arial,Helvetica,sans-serif; color: #000000;">&nbsp;</span></p>
<p style="margin: 0 0 0 30px;"><span style="font-family: 'Courier New',Courier,monospace;">UPDATE.RECORD STOCK 01-1745 IN.STOCK,0</span></p>
<p><span style="font-size: 10pt; font-family: Arial,Helvetica,sans-serif; color: #000000;">&nbsp;</span></p>
<p>This update amends field IN.STOCK of record 01-1745 in the STOCK file to be zero.</p>
<p><span style="font-size: 10pt; font-family: Arial,Helvetica,sans-serif; color: #000000;">&nbsp;</span></p>
<p><span style="font-size: 10pt; font-family: Arial,Helvetica,sans-serif; color: #000000;">&nbsp;</span></p>
<p style="margin: 0 0 0 30px;"><span style="font-family: 'Courier New',Courier,monospace;">UPDATE.RECORD SALES ALL TOTAL.SOLD, EVAL &quot;TOTAL.SOLD + THIS.MONTH&quot; THIS.MONTH,0 EXCLUSIVE REPORTING LPTR 2</span></p>
<p><span style="font-size: 10pt; font-family: Arial,Helvetica,sans-serif; color: #000000;">&nbsp;</span></p>
<p>This update processes all records from the SALES file, adding the current value of the THIS.MONTH field into the TOTAL.SOLD field, resetting THIS.MONTH to zero. The <span style="font-weight: bold;">EXCLUSIVE</span> keyword ensures that the file is not updated by other users during the amendment. A detailed report of the changes is sent to print unit 2.</p>
<p><span style="font-size: 10pt; font-family: Arial,Helvetica,sans-serif; color: #000000;">&nbsp;</span></p>
<p><span style="font-size: 10pt; font-family: Arial,Helvetica,sans-serif; color: #000000;">&nbsp;</span></p>
<p style="margin: 0 0 0 30px;"><span style="font-family: 'Courier New',Courier,monospace;">UPDATE.RECORD PAYROLL INQUIRING SALARY,EVAL &quot;SALARY * 1.05&quot;</span></p>
<p><span style="font-size: 10pt; font-family: Arial,Helvetica,sans-serif; color: #000000;">&nbsp;</span></p>
<p>This update processes entries of the PAYROLL file specified in response to a record id prompt, increasing the value of SALARY by 5%.</p>
<p><span style="font-size: 10pt; font-family: Arial,Helvetica,sans-serif; color: #000000;">&nbsp;</span></p>
<p><span style="font-size: 10pt; font-family: Arial,Helvetica,sans-serif; color: #000000;">&nbsp;</span></p>
<p style="margin: 0 0 0 30px;"><span style="font-family: 'Courier New',Courier,monospace;">UPDATE.RECORD STOCK FROM 2 5,&quot;12/9/96&quot; CONV &quot;D2/&quot;</span></p>
<p><span style="font-size: 10pt; font-family: Arial,Helvetica,sans-serif; color: #000000;">&nbsp;</span></p>
<p>This update uses select list 2 to identify records of the STOCK file in which field 5 is to be set to the internal form of the date 12/9/96.</p>
<p><span style="font-size: 10pt; font-family: Arial,Helvetica,sans-serif; color: #000000;">&nbsp;</span></p>
<p><span style="font-size: 10pt; font-family: Arial,Helvetica,sans-serif; color: #000000;">&nbsp;</span></p>
<p><span style="font-weight: bold;">The Report</span></p>
<p><span style="font-size: 10pt; font-family: Arial,Helvetica,sans-serif; color: #000000;">&nbsp;</span></p>
<p>The <span style="font-weight: bold;">REPORTING</span> keyword causes <span style="font-weight: bold;">UPDATE.RECORD</span> to generate a detailed report of its actions. This can be used as a simple audit trail of the changes made to the file and also contains information that enables recovery from an incorrect amendment.</p>
<p><span style="font-size: 10pt; font-family: Arial,Helvetica,sans-serif; color: #000000;">&nbsp;</span></p>
<p>The report shows the start of the amendment for a given record, the changes made to each field and the termination of the update at the point when the record has been written back to the file. Missing records and records which have been created by <span style="font-weight: bold;">UPDATE.RECORD</span> are highlighted in this report.</p>
<p><span style="font-size: 10pt; font-family: Arial,Helvetica,sans-serif; color: #000000;">&nbsp;</span></p>
<p>A command such as</p>
<p><span style="font-size: 10pt; font-family: Arial,Helvetica,sans-serif; color: #000000;">&nbsp;</span></p>
<p style="margin: 0 0 0 30px;"><span style="font-family: 'Courier New',Courier,monospace;">UPDATE.RECORD STOCK FROM 2 OLD.VALUE,VALUE VALUE,EVAL &quot;VALUE*1.1&quot; CREATING</span></p>
<p><span style="font-size: 10pt; font-family: Arial,Helvetica,sans-serif; color: #000000;">&nbsp;</span></p>
<p>might produce a report including the following lines</p>
<p><span style="font-size: 10pt; font-family: Arial,Helvetica,sans-serif; color: #000000;">&nbsp;</span></p>
<p style="margin: 0 0 0 30px;"><span style="font-family: 'Courier New',Courier,monospace;">Start of update of record '01-1268'</span></p>
<p style="margin: 0 0 0 30px;"><span style="font-family: 'Courier New',Courier,monospace;"> &nbsp;Field OLD.VALUE was '' now '90'</span></p>
<p style="margin: 0 0 0 30px;"><span style="font-family: 'Courier New',Courier,monospace;"> &nbsp;Field VALUE was '90', now '99'</span></p>
<p style="margin: 0 0 0 30px;"><span style="font-family: 'Courier New',Courier,monospace;"> &nbsp;Completed update of record '01-1268'</span></p>
<p style="margin: 0 0 0 30px;"><span style="font-family: 'Courier New',Courier,monospace;">Record '01-6723' locked by another user.</span></p>
<p style="margin: 0 0 0 30px;"><span style="font-family: 'Courier New',Courier,monospace;">Creating record '01-7491'</span></p>
<p style="margin: 0 0 0 30px;"><span style="font-family: 'Courier New',Courier,monospace;"> &nbsp;Field OLD.VALUE was '75' now '80'</span></p>
<p style="margin: 0 0 0 30px;"><span style="font-family: 'Courier New',Courier,monospace;"> &nbsp;Field VALUE was '80', now '88'</span></p>
<p style="margin: 0 0 0 30px;"><span style="font-family: 'Courier New',Courier,monospace;"> &nbsp;Completed update of record '01-7491'</span></p>
<p><span style="font-size: 10pt; font-family: Arial,Helvetica,sans-serif; color: #000000;">&nbsp;</span></p>
<p>This example shows the report entries for update of a record found in the file, a record that was not updated because it was locked by another user and a record that was created by <span style="font-weight: bold;">UPDATE.RECORD</span>.</p>
<p><span style="font-size: 10pt; font-family: Arial,Helvetica,sans-serif; color: #000000;">&nbsp;</span></p>
<p>If the <span style="font-weight: bold;">CREATING</span> option was not used, record 01-7491 would have produced the following report line</p>
<p><span style="font-size: 10pt; font-family: Arial,Helvetica,sans-serif; color: #000000;">&nbsp;</span></p>
<p style="margin: 0 0 0 30px;"><span style="font-family: 'Courier New',Courier,monospace;">Record '01-7491' not found.</span></p>

</td></tr></table>

</body>
</html>
