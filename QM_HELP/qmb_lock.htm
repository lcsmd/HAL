<!DOCTYPE html>
<html>
<head>
   <title>LOCK</title>
   <meta name="generator" content="Help &amp; Manual" />
   <meta name="keywords" content="LOCK" />
   <meta http-equiv="Content-Type" content="text/html; charset=UTF-8" />
   <meta http-equiv="Content-Style-Type" content="text/css" />
   <link type="text/css" href="default.css" rel="stylesheet" />
   <script type="text/javascript" src="jquery.js"></script>
   <script type="text/javascript" src="helpman_settings.js"></script>
   <script type="text/javascript" src="helpman_topicinit.js"></script>

   <script type="text/javascript">
     HMSyncTOC("index.html", "qmb_lock.htm");
   </script>
   <script type="text/javascript" src="highlight.js"></script>
   <script type="text/javascript">
     $(document).ready(function(){highlight();});
   </script>
</head>
<body style="margin: 0px 0px 0px 0px; background: #FFFFFF;">


<table width="100%" border="0" cellspacing="0" cellpadding="5" bgcolor="#649CCC">
  <tr valign="middle">
    <td align="left">
      <h1 class="p_Heading1"><span class="f_Heading1">LOCK</span></h1>

    </td>
    <td align="right">
     <span style="font-size: 9pt">
     <a href="titlepage.htm"><img src="top.gif" border=0 alt="Top"></a>&nbsp;
     <a href="qmb_locate.htm"><img src="previous.gif" border=0 alt="Previous"></a>&nbsp;
     <a href="qmb_logmsg.htm"><img src="next.gif" border=0 alt="Next"></a>
     </span>
    </td>
  </tr>
</table>


<!-- Placeholder for topic body. -->
<table width="100%" border="0" cellspacing="0" cellpadding="5"><tr valign="top"><td align="left">
<p><span style="font-size: 10pt; font-family: Arial,Helvetica,sans-serif; color: #000000;">&nbsp;</span></p>
<p>The <span style="font-weight: bold;">LOCK</span> statement obtains one of 64 system wide task locks.</p>
<p><span style="font-size: 10pt; font-family: Arial,Helvetica,sans-serif; color: #000000;">&nbsp;</span></p>
<p><span style="font-size: 10pt; font-family: Arial,Helvetica,sans-serif; color: #000000;">&nbsp;</span></p>
<p><span style="font-weight: bold;">Format</span></p>
<p><span style="font-size: 10pt; font-family: Arial,Helvetica,sans-serif; color: #000000;">&nbsp;</span></p>
<p style="margin: 0 0 0 30px;"><span style="font-weight: bold;">LOCK</span> <span style="font-style: italic;">lock.num</span> {<span style="font-weight: bold;">THEN</span> <span style="font-style: italic;">statement(s)</span>} {<span style="font-weight: bold;">ELSE</span> <span style="font-style: italic;">statement(s)</span>}</p>
<p><span style="font-size: 10pt; font-family: Arial,Helvetica,sans-serif; color: #000000;">&nbsp;</span></p>
<p>where</p>
<p><span style="font-size: 10pt; font-family: Arial,Helvetica,sans-serif; color: #000000;">&nbsp;</span></p>
<div style="text-align: left; text-indent: 0; padding: 0 0 0 0; margin: 0 0 0 30px;"><table style="border:none;border-spacing:0;padding:0;line-height: normal;"><tr style="vertical-align:baseline"><td style="border:none;padding:0;width:150px"><span style="font-style: italic;">lock.num</span></td><td style="border:none;padding:0">evaluates to the lock number in the range 0 to 63.</td></tr></table></div><p style="text-indent: -150px; margin: 0 0 0 180px;"><span style="font-size: 10pt; font-family: Arial,Helvetica,sans-serif; color: #000000;">&nbsp;</span></p>
<div style="text-align: left; text-indent: 0; padding: 0 0 0 0; margin: 0 0 0 30px;"><table style="border:none;border-spacing:0;padding:0;line-height: normal;"><tr style="vertical-align:baseline"><td style="border:none;padding:0;width:150px"><span style="font-style: italic;">statement(s)</span></td><td style="border:none;padding:0">are statements to be performed depending on the outcome of the <span style="font-weight: bold;">LOCK</span> operation.</td></tr></table></div><p><span style="font-size: 10pt; font-family: Arial,Helvetica,sans-serif; color: #000000;">&nbsp;</span></p>
<p>The <span style="font-weight: bold;">THEN</span> and <span style="font-weight: bold;">ELSE</span> clauses are both optional. Neither is required.</p>
<p><span style="font-size: 10pt; font-family: Arial,Helvetica,sans-serif; color: #000000;">&nbsp;</span></p>
<p>Task locks provide a means of synchronising the activities of multiple processes without using locks on records in data files. The <span style="font-weight: bold;">LOCK</span> statement attempts to acquire the lock identified by <span style="font-style: italic;">lock.num</span>.</p>
<p><span style="font-size: 10pt; font-family: Arial,Helvetica,sans-serif; color: #000000;">&nbsp;</span></p>
<p>The <span style="font-weight: bold;">THEN</span> clause is executed if the lock was available or was already held by this process.</p>
<p><span style="font-size: 10pt; font-family: Arial,Helvetica,sans-serif; color: #000000;">&nbsp;</span></p>
<p>The <span style="font-weight: bold;">ELSE</span> clause is executed if the lock is held by another process. If no <span style="font-weight: bold;">ELSE</span> clause is present, the <span style="font-weight: bold;">LOCK</span> statement waits for the lock to become available. This wait can be interrupted by using the break key.</p>
<p><span style="font-size: 10pt; font-family: Arial,Helvetica,sans-serif; color: #000000;">&nbsp;</span></p>
<p>The <span style="font-weight: bold;"><a href="qmb_status.htm" class="topiclink">STATUS()</a></span> function returns zero if the lock was free when the <span style="font-weight: bold;">LOCK</span> statement was executed. Otherwise it returns the user number of the process that held the lock. This will be the user number of the current process if it already owned the lock.</p>
<p><span style="font-size: 10pt; font-family: Arial,Helvetica,sans-serif; color: #000000;">&nbsp;</span></p>
<p>There is no means for a program to determine which task locks are held by the user except by using <span style="font-weight: bold;"><a href="qmb_testlock.htm" class="topiclink">TESTLOCK()</a></span> against each lock in turn. Beware that unlike read, update and file locks, task locks are only automatically released on leaving QM, not on return to the command prompt.</p>
<p><span style="font-size: 10pt; font-family: Arial,Helvetica,sans-serif; color: #000000;">&nbsp;</span></p>
<p><span style="font-size: 10pt; font-family: Arial,Helvetica,sans-serif; color: #000000;">&nbsp;</span></p>
<p><span style="font-weight: bold;">Examples</span></p>
<p><span style="font-size: 10pt; font-family: Arial,Helvetica,sans-serif; color: #000000;">&nbsp;</span></p>
<p style="margin: 0 0 0 30px;"><span style="font-family: 'Courier New',Courier,monospace;">LOCK 7 THEN</span></p>
<p style="margin: 0 0 0 30px;"><span style="font-family: 'Courier New',Courier,monospace;"> &nbsp; ...</span><span style="font-family: 'Courier New',Courier,monospace; font-style: italic;">processing statements</span><span style="font-family: 'Courier New',Courier,monospace;">...</span></p>
<p style="margin: 0 0 0 30px;"><span style="font-family: 'Courier New',Courier,monospace;"> &nbsp; UNLOCK 7</span></p>
<p style="margin: 0 0 0 30px;"><span style="font-family: 'Courier New',Courier,monospace;">END</span></p>
<p style="margin: 0 0 0 30px;"><span style="font-family: 'Courier New',Courier,monospace;">ELSE ABORT &quot;Cannot obtain task lock&quot;</span></p>
<p><span style="font-size: 10pt; font-family: Arial,Helvetica,sans-serif; color: #000000;">&nbsp;</span></p>
<p>This program fragment obtains task lock 7, performs some critical processing and then releases the lock. The program aborts if the lock is not available.</p>
<p><span style="font-size: 10pt; font-family: Arial,Helvetica,sans-serif; color: #000000;">&nbsp;</span></p>
<p><span style="font-size: 10pt; font-family: Arial,Helvetica,sans-serif; color: #000000;">&nbsp;</span></p>
<p style="margin: 0 0 0 30px;"><span style="font-family: 'Courier New',Courier,monospace;">LOCK 7</span></p>
<p><span style="font-size: 10pt; font-family: Arial,Helvetica,sans-serif; color: #000000;">&nbsp;</span></p>
<p>This statement attempts to obtain task lock 7 but, unlike the previous example, waits for the lock to become free if it is owned by another user.</p>
<p><span style="font-size: 10pt; font-family: Arial,Helvetica,sans-serif; color: #000000;">&nbsp;</span></p>
<p><span style="font-size: 10pt; font-family: Arial,Helvetica,sans-serif; color: #000000;">&nbsp;</span></p>
<p><span style="font-weight: bold;">See also:</span></p>
<p><span style="font-weight: bold;"><a href="clear_locks.htm" class="topiclink">CLEAR.LOCKS</a></span>, <span style="font-weight: bold;"><a href="lock.htm" class="topiclink">LOCK</a></span> (Command), <span style="font-weight: bold;"><a href="list_locks.htm" class="topiclink">LIST.LOCKS</a></span>, <span style="font-weight: bold;"><a href="qmb_testlock.htm" class="topiclink">TESTLOCK()</a></span>, <span style="font-weight: bold;"><a href="qmb_unlock.htm" class="topiclink">UNLOCK</a></span></p>

</td></tr></table>

</body>
</html>
