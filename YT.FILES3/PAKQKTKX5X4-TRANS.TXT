{
  "transcript": "all right so I have spent many long nights trying to build the ultimate smart home voice assistant and I think I've gotten pretty far I've put voice assistant in the ceiling of all the rooms of my home and whenever she speaks her voice comes out of the in seiling speakers which is actually pretty cool the problem is that that solution is powered by Amazon and there's some privacy concerns there you could use apple you could use Google but the privacy concerns still remain so until recently there has not really been a good solution to rep Place those big tech companies home assistant however came out with their assist Pipeline and we're going to set that up today but what you'll quickly realize is that there are some limitations to that tooling you have to go in and program it you have to teach it how to control your smart home and it doesn't really have access to human knowledge and it can't set timers and I know they're working on that stuff but it's going to take a long time to get there I want one I want a Golden Goose now you could also hook up home assistant assist pipeline to chat GPT the problem is that integration only allows you to chat with the AI it can't actually control your home no I want one of those and that's exactly what we're going to build today we are going to connect open AI chat GPT to home assistant so that it can control your smart home in really magical ways now I know what you're thinking you're saying why would I hook up my hyperlocal privacy Centric smart home to a artificial intelligence that's in the cloud somewhere that's stupid use your common sense well the good news is you could build your own local llm in your home I'm really excited after we talk about the software we're going to go into the hardware and that's taking these things these are the Wyoming satellites by home assistant and putting these in the ceilings and replacing Amazon entirely I'm going to be able to call out to it by saying hey Alfred and it's going to do amazing stuff super cool this is clearly the future major breakthrough let's build it together all right so here we are in my home assistant and if I click on assist up here in the top right hand corner you can see uh I have two pipelines one is called Fast GPT which uses a open AI integration custom integration built by a brilliant software engineer who I'll be sure in link to below and then it also uses nabuk kasa's cloud-based uh speech to text and text to speech and then I have slow GPT which does all that stuff locally without even an internet connection all right so if I say uh what time is it you'll see that the open AI llm actually knows my current time what is the current weather so you can see it actually knows the weather as well and this is amazing because I'm just feeding open AI raw information like a timestamp and raw Json about the weather and it's able to uh respond with human readable uh you know responses here which is just amazing um then I can ask things like uh how many lights do I have installed in my home 38 lights um and let's do uh who is home right now who is home right now and I'll make some we'll see what happens so there you go right the following individuals are currently in home oia's in the master bedroom Brad is at the media room um this is just really amazing right uh chat GPT is looking at my presentence sensors where it's tracking my watches and it's just aggregating that information and telling me which people are in which rooms um let's see another example uh is the front door locked is currently unlocked so I'll just say please lock it uh and there you go the front door is locked wow wow wow let's do some like general knowledge examples uh who is Bruce Wayne right it's a fictional character of Batman just really like things like uh how many cups are in an ounce strike that reverse it this way please all right things you would scream at your voice assistant for example here I'll actually use my voice right set the media room mood lighting to Green the media removed lighting has been set to Green so you can see it's set to green back there now set the the media room mood lighting to purple and turn on the media room fans and open the garage door the media room mood lighting has been set to purple the media room fans have been turned on the garage door has been opened and if I close this and I look down yeah you can see my garage door is open now nice that's an example of just stringing together a bunch of commands and open AI just paring all that out and then issuing three different commands to the server to cause those things to happen just extremely impressive that it can do this type of stuff right out of the box uh where is my home theater remote r e m o t if you need assistance in finding it feel free to ask I need assistance to find the remote please ping it and here it is right um so it knows let me make that stop so it knows in this case that uh it went to settings scripts find home theater remote so it actually executed the script which is just again like it's just amazing that they can do this stuff out of the box um where is my car and like if my if the car is moving and its GPS coordinates have changed it'll actually tell me like how many miles away the car is from the home um it actually told me the other day uh I said where is my wife and and uh it knew that my wife was in the car cuz her present sensor detected her in the car and it responded by telling me that she was 14 miles away I mean like I'm not coding that stuff the AI is just doing this all right so let's go and install the fast GPT pipeline from scratch together so go to settings in your home assistant then we're going to go to Voice assistants down here and we're going to click add assistant and we're going to call this a demo fast GPT uh leave mainly everything at default so English is fine conversation agent you will not have this Choice which is called extended open AI conversation so we need to go install that um but before we do I'm going to go ahead and create this pipeline so we'll just use home assistant for the moment uh English is fine home assistant Cloud which is default also American English is fine text of speech we'll say home assistant Cloud but we're going to do British English and uh we'll set this to Ryan neural I really like his voice um you may not have a wake word choice down here because you haven't installed the integration yet um that's okay I'm going to go ahead and just say my wake word is uh okay NAU okay we'll talk about how to install Wake word in just a moment so we click create now this is a pretty dumb pipeline right it's not using the open AI integration so like for example if I go and use this Pipeline and uh I select demo fast GPT and I say what time is it um yeah it's just not going to know right the default home assistant conver ation agent just isn't that intelligent yet if you go over to uh this guy's [Music] repository I'll pronounce it uh jeelan uh dude you are brilliant this is an amazing project please continue doing what you're doing um so guys you want to follow his steps here so you'll go to hacks you'll install his repo so I'm going to copy the URL to his GitHub repo up here and uh back in home assistant I'll go to to hacks if you don't have hacks installed uh just Google how to install hacs hacks in home assistant and you'll find plenty of tutorials on how to do this I'm going to go to Integrations and then on these three dots in the top right hand corner I'm going to say custom repositories and I would paste in his repository and I would say this is an integration and then click add after you do that you're going to see that it pops up here as a customer repository now right so I I will not add it again okay so at that point you'll need to restart your home assistant and then we're going to go to settings devices and services and we're going to add that integration in right so we go to settings again and devices and then we click add integration and we're going to say open uh AI conver ation here it is extended open AI conversation so you click it and you're going to give it a name so you might just want to call it open AI or chat GPT whatever you find best um and you need to get an API key all right so to get your API key you're going to go to platform. open.com API Keys um and uh you need to have an account with openai to get this far so make sure you create an account at open.com and then you're going to click create new secret key give it a name like home assistant and then we'll say create and it will give you this key copy it and go right back into home assistant and paste that key in here all right click submit there you go now if you go down to your um Extended open AI conversation you'll see that you have a your new chat GPT configuration has been set up all right so let's go into this default configuration and you'll see that the prompt States you are a smart home manager for home assistant uh I will provide you with information about the smart home along with a question you will act truthfully and uh you know respond succinctly um and then it passes in the current time and then it has this right here which essentially iterates through your exposed entities in home assistant and by exposed entities I mean if you go to any entity in your home assistant like I'll go to my garage door and uh then I'll go to settings and there's voice assistants here so you can see I've exposed this particular entity to assist you have to do that if the device is not exposed then it will not be visible to chat GPT and you can also uh add aliases here so if you have a entity whose name is not really human readable you might want to create some convenient aliases here all right so here it is iterating through all the entities you've exposed to assist and then it's basically pumping in a CSV so the entity ID The Entity name the entity State and then all of the aliases then it provides some rules here at the bottom use the execute Services function only for requested action and uh the execute Services function you can see is down here below this is using open A's uh function call capability you can actually go read about it just do some Googling but what you can do is you can train chat GPT to execute that function right so just like we're feeding chat GPT weather information or datetime information or the state of you know door you can also feed it a function and then execute that function later and uh the other thing I want to point out is that I have a slightly modified version of this prompt so and I'm using a different model he's using GPT 3.5 turbo so let's go to mine real quick and I'll share this in the uh the comments some key differences are I'm telling them that you know you have all the knowledge in the universe I don't want you to just be a smart home assistant I want you to also be like the world's most knowledgeable Butler basically so it it it's a dual purpose prompt the other thing I'm doing is like trying to help it better answer key questions like how many devices I have and handling specific States and reading out dates in human readable formats and and things like that so I I'll copy this prompt below the other key difference is I'm using GPT 3.5 turbo 1106 um you will probably have complex interactions with uh chat GPT and if you don't use -106 you might get some weird errors so just add on the -106 um all the other settings you can keep it his default and we're going to go back to our voice pipeline that we built earlier remember we called it demo fast GPT and in there you're now going to have a choice of remember you named it chat GPT and by the way you can click this little uh Cog icon and you can quickly get in to edit your prompt and change settings now we're going to go back to the dashboard so I can say what time is it and you'll see it responded with a like a weird Tim stamp and that's again copy paste my prompt it solves this problem there you go and so you know you can ask things like set the media room uh mood lights to green and uh it should work work there you go his integration is just magical major props to Jean your brilliant dude thanks for this project that is how you build your own fast GPT now let's talk about how I built slow GPT using my own uh open wake word my own Piper and my own whisper so in in simple terms here wake word is when you say Hey Google or hey Siri Piper is your text to speech so it enables your uh voice assistant or your computer to speak out loud to read the response to you you have to install these entities so let's go and do that now and then we'll build the slow GPT Pipeline and we'll run everything locally all right so head on over to settings and then add-ons and you'll go to the add-on store and you'll search up for let's start with whisper so speech to text and we'll go ahead and install that start on boot is good uh we'll turn on Watchdog and we'll even turn on auto update I'll go to configuration tiny int 8 is great I'll stick with that for now we'll basically leave everything at default here now let's also go and install Piper and we'll install that again I'll turn on Watch Dog so if it crashes it reboots and auto update let's go to configuration again and I'm going to set this to LC low I just found that to be just a little bit quicker like it was worth it um everything else I'm going to leave at default click save I'm going to restart Piper we're going to go back don't forget you got to go back to whisper I'm going to start whisper too so uh last add-on to include is open wake word and we'll go ahead and install that okay and take a quick look at configuration again I'll leave everything at default let's go ahead and start now that you've installed all those add-ons you can go to uh Integrations and you'll see that you have open wake word Piper a whisper right here so click configure on those configure on Piper and configure on whisper now those Integrations have been brought in and they'll all fall under the Wyoming protocol here so you can see open wake word Piper and Whisper now that that's done you can go back to your voice assistants and we'll create a new voice assistant called slow GPT uh demo slow GPT we use our uh chat GPT conversation agent that we built earlier and under speech to text we'll use faster whisper we'll leave it to English uh under text to speech we will set it to hyper and uh sure we'll just stick with default Amy L let's see what she sounds like hello how can I assist so you can fiddle with those a little later but at least we're doing all our text to speech stuff locally and then we'll do open wake word and uh we'll set it to OK Nabu all right so now you have a full local pipeline that is the only Cloud part is it's reaching out to chat GPT via your API key so click create and now if I go run my slow demo slow GPT you'll see I could say uh tell me what time it is the current time is 223-229 044 col 40415 28-5 remember to paste in my prompt it will solve this issue um but now you are running almost your entire pipeline locally okay so now for the final piece to create our own local llm and then replace open AI chat GPT um and I have a server running here at home uh it actually sits on you know with the unraid supervisor and uh I'm using local AI here so you can actually see that I have started local AI already which takes forever to start and I'm uh running a model called uh Luna demo um if you want to learn about local AI you can go to local ai. it is basically um a open-source llm and you can install all kinds of different models into it uh you can go to huggingface doco and you can download all kinds of different models and you can load those models into local Ai and local AI slaps a API on top of it that looks just like chat gpt's API so it's a drop-in replacement for chat GPT so once you get uh local AI up and running with uh a model and by the way you need the right kind of model uh not all models have open AI functions and remember you need open AI functions in order for the um the integration in home assistant to work into home assistant and we'll go to settings we'll go to integ ations we'll go to extended uh open uh AI conversation we'll create a new service like we did before we'll call this local AI llm API key it doesn't really matter 1 2 3 4 um let me go and uh grab the IP address and ports and it is not running at a secure URL click submit and there you go so now I'm going to go back to my my slow GPT and I can hit uh local AI llm now say update going to go over here and we'll say uh who is Bruce Wayne o whoops Wayne one eternity later all right there we go and you can see uh here in the logs uh you know this is our local llm that's sending this response yeah so that's pretty much it and I hope it is as mind-blowing for you as it is for me I think this is a really amazing breakthrough um the next step is to install this voice assistant into uh the ceiling and uh we'll use the Alfred wake word and it will also be hitting our own local llm and we'll even maybe unplug the home from the internet and start actually controlling the home with our own local AI powered Voice Assistant um so the future is here super super cool thanks guys see you soon",
  "duration": 22,
  "comments": []
}
