     *DEFFUN FORMCSV(ARRAY,DELIM)
     *GOSUB INIT:
     *GOSUB ADD.HEADER:
     SELECT.STR = "GET-LIST I2"
     PRINT SELECT.STR
     EXECUTE SELECT.STR
     CMD.STR = "DOWNLOAD I2.PRODUCT @I2 FORMAT TAB HEADING FIELD.NAMES FILE TRADE TRADE.CSV OVERWRITING"
     PRINT CMD.STR
     EXECUTE CMD.STR
     STOP

*INIT:
*
     *SEQ = 1000000
*
     *CSV.FILE.NAME="TRADE.CSV"
     *DELIM = "TAB"
*
     *OPEN "I2.PRODUCT" TO I2.PRODUCT ELSE PRINT "I2.PRODUCT";STOP
*
     *OPENSEQ "TRADE",CSV.FILE.NAME TO CSV.FILE ELSE CREATE CSV.FILE ELSE PRINT "UNABLE TO OPEN TRADE,":CSV.FILE.NAME; STOP
     *OPEN "TRADE.CATALOG" TO TRADE.CATALOG ELSE PRINT "TRADE.CATALOG";STOP
*
     *OPEN "DICT","I2.PRODUCT" TO D.I2.PRODUCT ELSE PRINT "DICT I2.PRODUCT";STOP
     *RETURN
*
*ADD.HEADER:
     *READV HEAD.LINE FROM D.I2.PRODUCT,"PRICES",2 ELSE PRINT "HEADER ENTRY NOT FOUND";STOP
     *HEAD.LINE = FORMCSV(HEAD.LINE,DELIM)
     *WRITESEQ HEAD.LINE ON CSV.FILE ELSE PRINT "UNABLE TO WRITE HEADER TO CSV FILE";STOP
*
     *KEY=SEQ
     *HEAD.LINE = CHANGE(HEAD.LINE," ",@VM)
     *WRITE HEAD.LINE ON TRADE.CATALOG,KEY
     *RETURN
*
*

