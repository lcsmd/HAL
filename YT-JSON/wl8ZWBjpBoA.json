{
    "wl8ZWBjpBoA": {
        "title": "How To Build A Telegram Chatbot That Controls Your Smart Home |  Chapter 1",
        "thumbnail": "https://i.ytimg.com/vi/wl8ZWBjpBoA/hqdefault.jpg",
        "author": "Technithusiast",
        "date_of_release": "2023-05-06T13:00:46Z",
        "duration": "PT19M40S",
        "view_count": "11624",
        "like_count": "323",
        "comment_count": "57",
        "description": "Get ready to level up your smart home! In this video, I show you how to install telegram and send messages to home assistant to control your automations. This is the first step before we are able to add GPT-3 to our chatbot.\n\nWould you like to show support? Buy me a coffee!\nhttps://bmc.link/mmontaque\n\nMy Node-Red-based Home Assistant Automation Chaperone Guide!\nhttps://montaque22.github.io/#/ai-master-class\n\n#tutorials #chatgpt #smarthome #nodered  #homeassistant  #chatbot",
        "transcript": "this is my office at night I have two smart bulbs in the room that are controlled by Google but I can also control them by home assistant I've recently been encountering situations where I don't want to disrupt the silence or the mics on my Google devices are muted and having a chatbot not only provides a way to control devices but is one step forward in creating an AI capable of managing my smart home this is a series where we explore and experiment with exciting smart home devices and interesting Tech and hopefully somewhere along the way you create something too cool for words this is a home assistant AI Master Class [Music] well welcome guys to my first video in the AI masterclass series so personally I created this because there's been a lot of occasions where I've wanted to trigger automations using my voice similar to like what you see with the big three but since at the time this wasn't really a possibility the next best thing was to create a chatbot that I could speak to or type 2 that could run my commands then later I found out that having a chatbot in general was actually pretty useful so here's what we're going to learn in this video we're going to learn how to set up telegram we're going to show you how to send your first message to home assistant using Telegram now this is the foundation for everything else that you're going to learn later on in this series and if you're wondering when you'll learn how to incorporate chat GPT into your home assistant that will happen in the next video but I encourage you to start with this video first because this is where we build the knowledge and the foundation so we can progress to the other stuff okay enough talk let's learn so installing telegram just to be clear it is best if you go to home assistance telegrams integration page to read through it for yourselves and follow the instructions the moment I create this tutorial and publish it might as well be carve it in stone because at some point the tech will change and this will become obsolete so it's best that you just always refer to the actual integration guides as opposed to this video and if you're seeing this years later again best read the instructions but far beat for me to stop you from listening to my TED talk now if you're on a Mac or on your phone download telegram app and sign up or sign in once you have the app you're going to need to contact the bot father Yes I said the butt father see this is what happens when you leave developers Alone by themselves they create like entire apps filled with dad jokes so take it as you will but once you find the bot father click the start button click on this give your Bot a name and a username and you're going to want to store the API key somewhere safe and make sure that no one else sees it or place it in a public site so don't like commit it to GitHub or anything like that just in case you can't find your Bot just type in the username that you created for it and it should show up here in the search right so you're also going to need a chat ID search for the get ID bot click Start you should see your information here along with the chat ID and you're going to want to store this chat ID too now it's time to head into the home assistant app this is where we add the integration in you'll need Studio code server or some way to edit your yaml files in home assistant I'm going to be using the studio code server so inside home assistant open up Studio code server and navigate to your config and add the following [Music] the API key is the same API key that you got from botfather and the allowed chat ID is the ID that you got from the get IDs bot after this just restart your config and you're all set so how to receive a telegram within home assistant for setting up automations I use node-red personally I find node-red's flexibility and visual layout very appealing and it fits my personal development style much better than the yaml based configs I'm pretty sure you can do the same thing in yaml that I'm doing in node-red but I will be honest I don't know how to do this using yaml as you'll later see later in this series Things become really easy using node-red especially when we're introducing gpt3 and some of the NLP engines it's just it just suits my development cell way better telegram provides three events that allows you to listen to information now we use this events node in order to actually tap into those events for convenience I've added these six nodes here so we can get through this quickly the three nodes on the left are the event notes the three notes on the right are the debugger which allows us to see what those events are the first event type we're going to look at is called telegram text this fires whenever you simply write plain text inside Telegram and you click Send the second event type we're going to look at is called telegram command this is a bit special because telegram allows you to fire commands right within the text so by prefixing your text with a forward slash telegram will treat it as a special command and will fire this event let's inspect the information I came back from the debugger when we go into the payload click on events we can see that the command is the same as the command that was sent inside telegram then if we check the previous command we see that Forge start is the same command that we see inside the debugger something additional you should know is that by adding in more words beyond that initial forward slash will treat those additional words as arguments so the command here would be hello but you can see that we have world and goodbye as arguments I want this to be easy to use for everyone else not just myself and I personally don't want to remember special commands and realistically using the forward slash and the text you're activating a special command I don't want to remember anything like that I don't expect anyone else to know anything like that so this is more of like a developery hack and I'm trying to avoid that now this is not to say that it's not useful and I may have a small number of these particular commands that I'll use to trigger systematic changes but I'm as a whole I'm just avoiding it now the last event type is called telegram callback I use this one a lot but it's harder to demo so I'll show you an existing automation that I have that uses it now these button here are created via an inline keyboard property I'll go for this in another video but just quickly to see when we choose telegram bot in the call service we have this inline keyboard which is responsible for the buttons so in some circumstances some of the automations can dynamically generate buttons in this case we're asking for the volume to be at 0.25 and instead of giving just a generic yes no we also have this third button when we click it we can see that the Callback type is telegram callback I use this event often because it allows me to reduce the guesswork needed to interact with the bot in some automations the bot will give users a choice and if the choices are predefined I find that it offers a better user experience and better user onboarding now that we have the basics down let's actually trigger automations from Telegram in node-red we simply need to add the call service node and under domain choose conversation and then process now we simply need to pass a Json object with the specified values in this case all we need is to pass text so we're going to set the text by using this variable here now currently at this moment message.telegram message that doesn't exist so if this were the fire it would be undefined so what we need to do is we need to Define it in the nodes that come before it so before we get to all of that we're going to go and grab this event node and we're basically going to call the telegram text remember this is the event type for when the user just simply writes plain text in Telegram now from here we're gonna we need to basically see what is inside this particular event so just to kind of walk that process I have this debug node and I'm going to set it to show the complete message object so that way when the event fires we can see everything and then we're going to deploy and then after deploying we're going to just write this test text and we can see that something comes back within the debugger so when we inspect we can see in payload and then under events we can see that the text is equal to test this is what we want so we're going to copy its path and this is what we're going to use now that we have the path of the text we can now convert that information to the format that we need so we're going to use this change node to do that now within this change node it's a bit special so what we can do is it basically allows us to change one VAR uh one value to another so we're going to set telegram message to the path that we just found so the payload.event.txt so this is going to basically take the value from the payload.event.txt and paste it into telegram message now once we connect it telegram message will now be complete so it will no longer be undefined by the time that note runs but we're going to do one more thing if we were to just send the message from telegram now and it completes nothing is going to happen within telegram so the user just won't know so we're going to use this additional node from the call service and we're going to basically send a message back to telegram so to give the user some indication that something happened in the domain we're going to do telegram brought service is going to be send message and then we're going to look at this message here and we're basically going to send a message using that key that key is What basically telegram looks at when it posts messages back to the app we're going to name the node [Music] we're going to deploy why hello there uh sorry for the inconvenience uh this video was made a while ago and between then and now home assistant made several updates and during one of those updates the conversation API which is being used in this process stopped working I don't know if it's intentional I don't know if it's an accident no idea but continue watching and I'll explain a little further how we can work around this this conversational process even though I kind of explained it to you this is what stopped working we can't use this anymore this is technically the whole Crux of this particular automation where you receive information from telegram you set the property for it it goes and it gets processed here and this will actually do the command so turning on the lights uh turning off your alarms whatever the case is whatever your automation is it'll do it if it was within the assists capabilities of doing because it mirrored assists now this doesn't work technically I could ignore this right we could ignore it we could move on and let's say just learn how to use the open API around it but then you kind of lose a lot of the flexibility and power that I wanted the chatbot to have and it just sucks it just sucks if you wanted to for those of you who use Google you could just replace it with basically the Google's version So within here instead of the conversation you would choose Google assistant and then you would choose under service send text command and then now all you have to do is this command is what would be what you would send to do the command so like turn off TV kitchen TV or whatever the case is you would just change this to command and then now it would work so same exact thing now it'd work but this would only work for those of you who are using Google within their home as like the Google Assistant everyone who's using Alexa anyone who's using uh Apple like anyone else to be honest this won't work for it and that's not good enough for me either so we need to come up with a different way of doing this I will tell you from now that this next way may not be the easiest way it's going to be interesting it won't be super easy I will do my best to make it clear in my explanation so let's go this is the call service node when we inspect it and we look at its help properties we can see here that they have some interesting helpful tips and tricks one of the things that caught my eye when I was looking at this is that you can pass things dynamically to it so for instance I see here turn underscore payload if we were to go and check what is here under home assistant and we look at service we can see that there's turn underscore off turn underscore on so what that template did was it allows us to choose which one we want to do we can have it turn off or on but dynamically we don't have to like have it hard coded into here so this is what we want and the fact that we can do it here suggests that we can probably do it for all of these other stuff so what we're looking to do now is to create this node to be dynamic such that when we receive text from telegram that we would have some kind of logic that will look at the text and say okay within this text what is the entity that I need and what action needs to be done to it so if I say turn off the light in the kitchen then it needs to know that okay The Entity is a kitchen light and I know that I'm turning it off and those need to be dynamically placed into the service as well as the entity so first thing we're going to do is we're going to get the inject node what the inject node would allow us to do is it allows us to start an automation without having to do anything besides from press a button here on the screen and you'll see what I mean shortly so we can take it just drag it to it and then now when we deploy nothing is going to happen at least you're not going to see anything but this button becomes clickable and when we click it it'll basically trigger and everything will start from this point moving forward all right so then now what we want to do is we're going to change this to home assistant and let's see service we have here turn on and turn off for the sake of testing this is what we're going to do I'm going to move this to the side and we can see here that we have several lights on in the house so we're going to create an automation that can trigger these things dynamically so I'm going to use a toggle because that's going to be easy for us to see but instead of hard coding toggle we're going to have that dynamically passed in so let's do this we're going to just call this action what this is saying is that that action is basically a variable and that variable if it's whatever that is it's going to try to run that variable or use that variable as an input for service so we want this variable action to say toggle but at the current moment nothing is defining that variable we're going to have to Define it elsewhere we're going to just call this entities entities now currently just like action entities is empty but whatever this variable is it's when it resolves it's going to get passed into this and it's going to use this as entity field it's going to use whatever value is entities so let's go Define these things now we don't need this I can delete that that's gone let's just click done and now we're not going to run this from telegram we can leave that telegram will still work uh but right now what we're going to do is we're going to trigger the automation from this inject node so to do that we first need to pass in those variables let me show you what it will look like if we don't do that so let's deploy I'll put it onto the debugger it's done so when I run it it's going to fail see call service node is missing API service property not found in the config or payload so it doesn't see anything it's saying that there's a problem that's because all of the stuff that we passed it the entities the action all of that is missing so let's define it now so we're going to call this action and we said that we want to call it toggle and then we're going to come here and we know we have entities and teeth and for this one because it's an array of items we're just going to use the Json or the jsonata we'll do the open close brackets and I believe the entity let's change the office Life Light left I believe that's what it's what it's called Uh I could be wrong but we'll find out done so right now when we trigger the this particular entity or when we triggered this node it's going to now have within its data flowing into the call service node action which is toggle and it's going to have entities which is this this is now defined so when we deploy I'll clear this give it a second I don't know where that happened but we'll see and now when we fire it instantly it worked this means that we can dynamically change things and if I press it again because it's the action toggle it should turn back on perfect okay so let's recap in total what we've done in this video is set up telegram connect the telegram to home assistant where home assistant can see the information coming from Telegram and now we've created the latter part where we can dynamically input actions and entities into home assistant to do some kind of action in general the only thing left now is to kind of connect the two pieces together the front and the back where now that we have the text from telegram to translate it or parse it into something that home assistant can understand and actually execute commands on that's going to be a bit tricky but we're gonna handle that in the next video we can't do that here it's going to be way too long I think it's going to be too overwhelming and I have to test a few things out bottom line is in the next video we're gonna dive deep into how we can get this to work hint we're going to be using open AI for this I think you guys are going to love this next video stay tuned for it okay bye [Music] thank you foreign [Music] [Music] [Music]"
    }
}