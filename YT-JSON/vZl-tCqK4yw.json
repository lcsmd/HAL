{
    "vZl-tCqK4yw": {
        "title": "Local Voice Control In Home Assistant Is Next Level!",
        "thumbnail": "https://i.ytimg.com/vi/vZl-tCqK4yw/hqdefault.jpg",
        "author": "Everything Smart Home",
        "date_of_release": "2023-05-12T18:06:48Z",
        "duration": "PT16M26S",
        "view_count": "148863",
        "like_count": "2483",
        "comment_count": "230",
        "description": "In this video we are taking a look at how to setup and configure the new local voice control features in Home Assistant so you can start controlling your smart home with your voice and various devices around your home! From push to talk, to analogue phones and voice pipelines, I will take you through step by step to get everything working!\n\nThank you to PCBWay for sponsoring this video, check them out: https://www.pcbway.com/\n\nParts for DIY:\nESP32 Development Board: https://amzn.to/3MlPH7L\nMicrophone: https://amzn.to/3LY3d0c\nAlternate mic: https://amzn.to/41CU1nr\nAmp: https://amzn.to/42QGKZz\nSpeaker: https://amzn.to/3I5R6Nl\n\nM5Stack Firmware flash:\nhttps://www.home-assistant.io/projects/thirteen-usd-voice-remote/\n\nESPHome example code:\nhttps://github.com/esphome/media-players/blob/main/m5stack-atom-echo.yaml\n\nIf you'd like to support me and future projects:\n\nPatreon:\nhttps://www.patreon.com/everythingsmarthome\n\nBuy Me a Coffee:\nhttps://www.buymeacoffee.com/EverySmartHome\n\nWritten Article:\nhttps://everythingsmarthome.co.uk\n\nEVERYWHERE YOU CAN FIND ME:\nEverything Smart Home Community Discord:\nhttps://discord.everythingsmarthome.co.uk\nTwitter: https://twitter.com/EverySmartHome (@EverySmartHome)\nInstagram: https://www.instagram.com/EverythingSmartHome/\nFacebook: https://www.facebook.com/everythingsmarthomeofficial/\n\n#homeassistant #smarthome\n________________________\n\nSome of the links above are affiliate links, where I earn a small commission if you click on the link and purchase an item. You are not obligated to do so, but it does help fund these videos in hopes of bringing value to you!\n\n0:00 - Intro\n1:11 - Configuring Pipelines\n7:11 - Debugging pipelines\n8:08 - Exposing entities to Assistants\n9:13 - Creating an ESP32 ESPHome powered speaker\n10:51 - PCBWay\n11:24 - Creating an ESP32 ESPHome speaker again\n13:23 - Setting up an analogue phone to work with Assist",
        "transcript": "home assistant released a bunch of new features that lets us start taking advantage of their new native Voice Assistant allowing you to start controlling aspects of your smart home using your voice and the best part is that it's all done locally with a focus on privacy and today I want to show you how you can start using all of these new features what we're going to do in this video is to take you through setting up a voice pipeline first since we need that working before any of the other voice features can actually work so we'll do that in home assistant and then I want to show you how to debug a pipeline and what to loot for and then finally we will take a look at how you can install push to talk on an ESP home device like this which I forgot to mention in the previous video this little guy is the M5 stack Echo it's a super tiny esp32 with a microphone and speaker how do they get all that in there it's a really cool device unfortunately it's a little difficult to find so we will talk about some alternatives so that is the echo I also want to show you how you can turn an old-school analog phone into a device that you can control your smart home with let's get into some pipelines first so a pipeline allows you to configure how your voice is processed through home assistant from the language to the speech to text engine to the text to speech engine and you can mix and match any of these components to suit your needs which is really useful if you have say for example a multi-language household since you can create multiple pipelines let's go ahead and create our first pipeline first head over to settings and then Voice assistance which will take you into the main configuration page for voice from this dashboard you can configure most of the things regarding voice control in home assistant including entities for Google home and Amazon as well as assist you can debug assist from this page and you can also create pipelines on this page by the way assist is what home assistant calls their voice assistant just in case you wondered why I was saying assist and not assistant there's too many assists and assistance I've got Google Assistant than home assistant voice assistance assist it's yeah the first thing we're going to want to do is to configure our pipeline so click on the home assistant option under the assist section which will bring up some additional dialog options the configuration section is where you can set the language the conversation agent section is where you can select where the conversation takes place the speech to text section processes your voice and turns it into speech and text to speech does the opposite however we aren't quite ready to configure this yet as you'll notice under the speech to text section that we have no options available and under the text-to-speech section I only have Google translate available which isn't locally processed so we need to fix both of these first cancel out and then head back into settings and then add-ons and then click the add-on store option and we're going to install two add-ons the first one being Piper Piper is going to handle our text to speech component locally on our machine so hit install and then on on the configuration tab you're going to want to select voice from the drop down according to your preference the ones with the high at the end are going to be the highest quality the ones with medium and low will be lesser quality then hit save and go back to the info tab hit the Watchdog option and then hit start go back to the add-on store and this time select whisper from the list to install which is going to handle our speech to text this will take our voice command from the microphone and convert what we see into text that home assistant can then understand once installed head over to configuration then make sure your language is selected from the drop down and then we need to select a model depending on your Hardware if you are using a Raspberry Pi 4 you will want to use the tiny int 8 model basically the higher up the models you go the more accurate it should be but the more intensive it is to run for your server so you may want to experiment and see which model is right for you with your Hardware hit save and then back on the info tab hit Watchdog and then start next head back to settings devices and services and if all went well you should see home assistant has discovered two new Integrations for whisper and Piper so go ahead and configure both of those now to make them available for use within pipelines and then we're going to head back to our Pipeline and complete the setup by going to settings and voice assistance for once again select the home assistant Pipeline and you can first give this a name if you want to I'm going to call mine home assistant local since I want to have both a local and a cloud pipeline then make sure your language is selected correctly in both language drop-downs the conversation agent is going to remain as home assistant for this example and now under the speech to text section I can select whisper and then under the text to speech section I can select piper then hit save to complete our local pipeline I then want to create a cloud pipeline too and if you are subscribed to nabucasa you can do the same by going to add assistant to create a second pipeline but this time select the home assistant Cloud option under speech to text and text to speech which gets you access to lots of high quality voices in different languages once you have your pipelines created you will want to designate one as the preferred pipeline which will be the default that gets he used for actions unless otherwise specified in automations or devices select the pipeline and then hit the little start icon to make it the preferred one now we can test out if the pipeline is working by heading to our dashboard then hitting the assist icon in the top right hand corner and then hitting the microphone button and giving a command this part does require https with a proper certificate to be enabled on your home assistant for the microphone button to show up and this is due to a limitation on the browser rather than home assistant imposing any limits just so you are aware I checked with Mike to ask if anything else requires https for it to work with voice assistance or assist and it doesn't so it's just if you want to use the microphone option in your browser then you will need https but for everything else you don't if you speak into the mic on this page you should see what you said appear in the box after just a couple of seconds and and if your command was correctly recognized then the action will happen nice we just gave our first command to our local voice assistant and it's super fast note that assist will make heavy use of caching here so you may find the first time a phrase is spoken that it takes a little longer and then saying it again after will make it even faster than before if we head back to the voice dashboard and then click our preferred Pipeline and then hit the three dots and then debug this gives us a debug page for seeing how our voice was processed you can see the spoken phrase or at least what the voice model thought the spoken phrase was how long it took to process the phrase and what the output was you can see how long the speech to text took how long the language processing took and how long the text to speech took this is really useful for identifying where slowdowns are so you can take action note that the speech to text processing time also accounts for how long you were speaking for so although it might say that it took three seconds for example two and a half seconds of that time could be me actually speaking and giving the voice command so just be aware of that when looking at the time you can also use the arrows and the drop down at the top to go back and forward through previous pipeline runs the entities tab on The Voice dashboard is where you will want to come to set up your devices and sensors with voice assistance and allow them to be used by assist Amazon and Google home where you can toggle any of your entities on or off for each one individually this lets you make sure that Google home or Amazon for example doesn't get too cluttered with the vast number of sensors that home assistant produces and also Narrows the scope for assistive work and make mistakes when you are giving a commands which is always a good thing if there is sensors and entities that you know for sure you will never need to use with a assist it's a good idea to untoggle them from this screen only nabucasa subscribers can expose entities for Google home or Amazon through this page currently if you don't use nabucasa but you do have a manual config of Amazon or Google home for example then you can still do that through your yaml configuration same as you've always been able to do though I believe that this may change in the future alright so now we've created our first pipeline which sets us up to use any of the voice Integrations and features in home assistant and we've also checked out the debug panel and how to expose entities next I want to show you how you can use a device like the M5 stack Echo as a push to talk device for giving voice commands so to do this you will need an M5 stack echo which is this esp32 with a microphone speaker button and even an LED inside all in this tiny little form factor super cool device unfortunately it's a little difficult to get your hands on right now with the announcement but since this is ESP home there are alternatives such as the Muse Lux a Bluetooth speaker that I have back there covered in a video a while back and that also has a microphone in it and obviously a speaker and it does work well for using with assist that works well so that is definitely an option and also since this is ESP home it's entirely possible to build one yourself using off-the-shelf components like I have also done back there this video isn't a guide on how to do that that is an entirely separate video in itself but all you need is an esp32 development board an i2s speaker and an amplifier to drive set speaker a button and of course an i2s microphone and back when you're of the voice was very first announced I had a feeling that having some microphones on hand were going to be really handy so months ago I had some custom microphone on breakout boards made at PCB way who kindly sponsored this video PCB way are a One-Stop shop for all of your prototyping and Manufacturing needs from 3D printing CNC injection molding and of course PCB Printing and assembly I use PCB away for making things like these little i2s microphones and other little custom pcbs all the way up to manufacturing literally thousands of everything presence once and they are fantastic to deal with so if you're looking to turn a DIY project into a professional looking PCB check out pcbway down in the description I'll try and leave some links down below for parts you need to make your own push to talk microphone since the echo is completely sold out almost everywhere it won't be pretty and it won't be as compact as the echo but hey it's at least a really fun project turn on the kitchen lights turn off the kitchen lights set the kitchen lights to Blue once you have your M5 stack or esp32 for a DIY build we need to install ESP home on it head over to the link below to go over to the easy install page for the M5 stack over on the home assistant documentation site and then scroll down and you will find a connect button hit that connect up your Echo to the USB port of your computer and then install the firmware and configure its Wi-Fi if you're building your own or using the Muse Lux I'll leave a link in the description to the example code for the M5 stack so that you can use it as a template to change it to your esp32 pinout using ESP home then head back to home assistant and into devices and the echo or your DIY device should be Auto magically discovered and ready to use once you add it to home assistant you can go in there and there will be an option to select which pipeline you want to use for that specific device now if you press and hold the button on the app should come on and you can start giving your command remember to keep holding the button and only releases speaking and depending on if your command was recognized or not the action should automatically happen nice remember that if your command didn't work you can always go into the debug page in the pipeline and see what's happened and what the phrase that was recognized was finally let's take you through how to set up the voice over IP integration to allow you to dial Home assistant from a regular old school analog Telephone Man really feels that we've come full circle doesn't it like we're back to using analog telephones to control our Smart Home super cool to make this work we're going to use this little black box from grandstream which is called the ht801 and basically this connects to our network via Ethernet and then we plug the rj11 cable from the phone directly into the back and that turns our old analog phone into a voice over IP phone which can then talk to home assistant and use the assist functionality to configure the grand stream plug it into your network and then power it on and then head to the IP address of it in your browser enter admin and admin for the credentials and then on the Antiquated web page click on the FX export button and scroll down to the off hook Auto dial box in this box you will want to enter the IP address of your home assistant server in the following format where 10.2.11.4 is the IP address of my home assistant server you will want to replace that with the IP address of your home assistant server making sure to leave the rest of the information intact and once done scroll down and hit apply now head back to home assistant and into settings and devices and then add a new integration and search for the voice over IP integration and hit add then pick up the telephone and after a few seconds you will hear a message telling you to enable voice in home assistant for this device refresh the page and you should see we now have one device under the voice over IP integration click on this device and then hit the allow calls button now when you pick up the telephone you will immediately be connected to home assistant and it's ready to accept commands [Music] turn on the kitchen lights [Music] set the kitchen lights to Blue [Music] all right and there we go that is how to set up all of the new voice features in home assistant how to configure pipelines and push to talk how to debug and how to use analog phones in your home assistant didn't think that would be a thing I would ever be seeing on a video but here we are let me know in the comments what your plans are for voice and home assistant if any really curious to hear all of your creative thoughts as always down below hope you enjoyed this video make sure to hit the like button and get subscribed if you haven't already and I will see you in the next video"
    }
}